---
layout: post
title: Git安装、配置、使用、常见问题汇总
category: dev-ops
tags: [dev-ops]
---

Git安装、配置、使用、常见问题汇总


## git介绍
Git 是一个开源的分布式版本控制系统   
![](../../assets/images/2021/devops/git-opt.png)

## 1.windows环境下载、安装
https://git-scm.com/download

## 2.linux安装git
```
$sudo apt-get install git
$git --version
```

## 3.Git Bash基本操作：克隆、切分支、日志查看、拉取、提交、推送
配置账号信息：    
```
$ git config --global user.name "Your Name"
$ git config --global user.email "email@example.com"` 
```

基本操作：  
``` 
git clone -b dev http://gitlab.xxx.com/root/xxx.git  //克隆Dev分支代码
git checkout -b dev //切换dev分支，同时本地分支新增检出dev分支
git checkout -b v0.9 origin/v0.9 //拉取远端 origin/v0.9，本地新增v0.9 ，并切换至v0.9
git log //查看提交记录
git branch //查看本地分支
git branch -a  //查看所有的分支
git branch -r  //查看远程所有分支
git pull //拉取远程代码并合并
git fetch  //相当于是从远程获取最新版本到本地，不会自动merge
git status //查看当前状态
git checkout . //本地所有修改的。没有的提交的，都返回到原来的状态，‘.’前面有空格
git add .  //添加所有改动文件
git commit -a -m"commit message"  //提交到本地
git push  //将本地分支推送到服务器上去。
git pull出错回滚
    1.git log 查看要回滚的版本
    2.git reset --hard "commit Id"
```

## 4.TortoiseGit 安装 配置
1.下载：  
https://tortoisegit.org/download/  
TortoiseGit下载页面: http://download.tortoisegit.org/tgit/  

2.安装：  
TortoiseGit使用需要依赖Git基础环境，所以首先安装Git基础环境。

3.配置Git.exe:   
TortoiseGit-> settings-> General-> Git.exe path 选择Git.exe安装目录  

4.tortoiseGit记住账号密码  
``` 
1.TortoiseGit-> settings-> git-> globle 设置name、email
在C:\Users\username下面，有一个.gitconfig目录，这个是记录git配置信息的。在该文件内容后面加上
[user]
	name = xx
	email = xx@xx.com

2.新添加.git-credentials
[credential]
    helper = store

3.检出项目，输入git用户名、密码，会在目录下面生成.git-credentials文件，文件明文记了输入的账号密码
https://username:password@github.com
```
5.ssh key 添加     
https://www.cnblogs.com/dongguangming/p/13900081.html   
https://blog.csdn.net/gnail_oug/article/details/78794339   
https://blog.csdn.net/weixin_43834567/article/details/88966369   
```
1.TortoiseGit -> PuttyGen ->Generate //生成过程中空白处晃动鼠标,生成后窗口先留着不关闭。

2.github-> setting-> SSH and GPG keys-> 添加生成的key

3.回到TortoiseGit Generate 界面-> Save private key: private.ppk

4.点击“Save public key”保存为authorized_keys文件（无扩展名）

5.配置SSH登录密钥: TortoiseGi-> Pageant-> Add key->选中之前配置生成的密钥文件（private.ppk）
``` 

## 5.分支合并、撤销、回滚版本、修改commit msg等操作
- 1.merger分支
    - 切换至master分支，更新代码至最新
    - merger，from哪个分支，如有冲突解决冲突，commit，push，没有冲突直接commit，push
- 2.只合并某个分支上的某次修改commit到指定的分支上.
    - 使用git log 查看提交的信息,记住commit id. 只需要将62ecb3，合并到master，而不合并其他commit
    - git checkout master  
    - git cherry-pick 62ecb3，62ecb3 就被合并到master分支 
- 3.撤销未提交删除操作: Revert
- 4.回滚版本：showlog -> 选择次提交记录 -> 右键 -> Revert “**branch” to this commit
- 5.撤销已提交（任意一次提交）: ...同上，revert change by this commit
- 6.修改的commit msg是当前分支的最新的一个 [commit msg](https://blog.csdn.net/weixin_33826609/article/details/86114634)
    - git commit 提交的界面，选择Amend Last Commit
    - 根据需要修改日志信息，包括commit message,日期，作者

## 6.常见问题解决
- 1.See "git help gc" for manual housekeeping——解决办法   

```
第一条命令是原因，第二条命令是解决办法
$ git fsck
dangling blob d9ff0aeac4aa8b4e0907daed675ebf60278bc977
dangling blob dbff2d073741f9775c815d04a3c623736af224dad
dangling blob e1ffbab1c5b985cd1cd3bc0281075ea2ed80744a
dangling blob fdff59878ccb3a75689f4acca615cfb635288774
 
$ git gc --prune=now
``` 

- 2.git运行突然提示 Auto packing the repository in background for optimum performance
查资料，原来是自己本地一些“悬空对象”太多(git删除分支或者清空stash的时候，这些其实还没有真正删除，成为悬空对象，我们可以使用merge命令可以从中恢复一些文件)

``` 
1.输入命令：git fsck --lost-found，可以看到好多“dangling commit” 
2.清空他们：git gc --prune=now，完成
```

- 3.git push error: RPC failed result=56, HTTP code = 0

```
error: RPC failed; result=56, HTTP code = 0
fatal: The remote end hung up unexpectedly
fatal: The remote end hung up unexpectedly
Everything up-to-date

通过设置Git的http缓存大小，解决了这个问题，在当前工程目录下运行如下命令：
git config --global http.postBuffer 20M
```

- 4.github访问龟速 ：获取、配置github hosts

```
1.访问：https://www.ipaddress.com/
2.搜索：github.com  //得到ip
3.搜索：github.global.ssl.fastly.net  //得到ip  
4.修改hosts： C:\Windows\System32\drivers\etc\hosts 
199.232.69.194 github.global.ssl.fastly.net
140.82.114.4 github.com

或者访问此链接直接下载hosts，https://cdn.jsdelivr.net/gh/521xueweihan/GitHub520@main/hosts

PS：修改hosts时，先修改文件权限，或者桌面新建hosts文件，编辑后复制替换到C:\Windows\System32\drivers\etc下
```

## git项目迁移
https://www.cnblogs.com/shijiaoyun/p/13527036.html  
将项目从git迁移到gitlab步骤：  

第一步：克隆老项目  
git clone --mirror https://XXXX/project.git  

第二步：gitlab创建新项目 
https://gitee.com/wdsheng0i/test.git  

第二步：设置新的地址 
git remote set-url --push origin https://gitee.com/wdsheng0i/test.git  

第三步：push 
git push --mirror https://gitee.com/wdsheng0i/test.git  

第四步：让其他同事执行以下操作，将git地址更新为新的git地址、或者从新的地址重新git clone  
git remote set-url origin http://new_XXXXXX/project.git  

## .gitignoref配置样例
``` 
### Java template
*.class

# Mobile Tools for Java (J2ME)
.mtj.tmp/

# Package Files #
*.jar
*.war
*.ear

# virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml
hs_err_pid*

### JetBrains template
# Covers JetBrains IDEs: IntelliJ, RubyMine, PhpStorm, AppCode, PyCharm, CLion, Android Studio and Webstorm
# Reference: https://intellij-support.jetbrains.com/hc/en-us/articles/206544839

# User-specific stuff:
.idea/workspace.xml
.idea/tasks.xml
.idea/dictionaries
.idea/vcs.xml
.idea/jsLibraryMappings.xml

# Sensitive or high-churn files:
.idea/dataSources.ids
.idea/dataSources.xml
.idea/dataSources.local.xml
.idea/sqlDataSources.xml
.idea/dynamic.xml
.idea/uiDesigner.xml

# Gradle:
.idea/gradle.xml
.idea/

# Mongo Explorer plugin:
.idea/mongoSettings.xml

## File-based project format:
*.iws

## Plugin-specific files:

# IntelliJ
/out/

# mpeltonen/sbt-idea plugin
.idea_modules/

# JIRA plugin
atlassian-ide-plugin.xml

# Crashlytics plugin (for Android Studio and IntelliJ)
com_crashlytics_export_strings.xml
crashlytics.properties
crashlytics-build.properties
fabric.properties

### Windows template
# Windows image file caches
Thumbs.db
ehthumbs.db

# Folder config file
Desktop.ini

# Recycle Bin used on file shares
$RECYCLE.BIN/

# Windows Installer files
*.cab
*.msi
*.msm
*.msp

# Windows shortcuts
*.lnk

### Maven template
target/
pom.xml.tag
pom.xml.releaseBackup
pom.xml.versionsBackup
pom.xml.next
release.properties
dependency-reduced-pom.xml
buildNumber.properties
.mvn/timing.properties

# ignore eclipse files
.project
.classpath
.settings
.metadata
.tern-project
.springbeans
```















